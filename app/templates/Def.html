<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Herbert Garrison</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      color: #333;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
    }

    .definition-container {
      max-width: 500px;
      width: 100%;
      background-color: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .definition-header {
      margin-bottom: 20px;
    }

    .definition-logo {
      width: 60px;
      height: 60px;
    }

    .definition-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    .definition-input {
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      outline: none;
      font-size: 16px;
    }

    .definition-button {
      background-color: #007bff;
      color: white;
      border-radius: 8px;
      padding: 12px;
      cursor: pointer;
      transition: background-color 0.3s;
      border: none;
      font-size: 16px;
    }

    .definition-button:hover {
      background-color: #0056b3;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #ccc;
      border-top: 4px solid #007bff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .definition-content {
      margin-top: 20px;
      text-align: left;
    }

    .reference-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      max-width: 100%;
    }

    .reference-card img {
      width: 100%;
      max-width: 150px;
      height: auto;
      border-radius: 4px;
      margin-bottom: 10px;
    }

    .reference-card a {
      color: #007bff;
      text-decoration: none;
      font-size: 16px;
      font-weight: bold;
    }

    .reference-card a:hover {
      text-decoration: underline;
    }

    /* Responsive design */
    @media (max-width: 600px) {
      .definition-container {
        padding: 15px;
      }

      .definition-logo {
        width: 50px;
        height: 50px;
      }

      .definition-input,
      .definition-button {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="definition-container">
    <div class="definition-header">
      <img src="https://media.tenor.com/wSsCWr9Ihl0AAAAi/wait-a-minute-herbert-garrison.gif" alt="Logo" class="definition-logo" />
      <h1>Herbert Garrison</h1>
    </div>
    <form id="definition-form" class="definition-form">
      <input
        type="text"
        id="definition-input"
        placeholder="Enter word"
        class="definition-input"
      />
      <button type="submit" class="definition-button">
        Define
      </button>
    </form>
    <div id="loading-spinner" class="loading-spinner" style="display: none;"></div>
    <div id="definition-content" class="definition-content"></div>
  </div>

  <script>
    let api=localStorage.getItem("api");
    async function fetchDefinitionData(word) {
      const re = "You are herbert garrison from south park explain "+ word + " Also include reference of the response";
      const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key='+api;
      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            contents: [
              {
                role: "user",
                parts: [{ text: re }]
              }
            ]
          })
        });
        const data = await response.json();
        return data.candidates[0]?.content?.parts[0]?.text || 'No definition found.';
      } catch (error) {
        console.error('Error fetching definition:', error);
        return 'Error fetching definition.';
      }
    }

    function convertMarkdownToHTML(markdown) {
      // Convert headers, bold, italic, links, and line breaks
      let html = markdown
        .replace(/### (.*$)/gim, '<h3>$1</h3>')  // ### Header
        .replace(/## (.*$)/gim, '<h2>$1</h2>')   // ## Header
        .replace(/# (.*$)/gim, '<h1>$1</h1>')    // # Header
        .replace(/\*\*(.*?)\*\*/gim, '<b>$1</b>') // **Bold**
        .replace(/\*(.*?)\*/gim, '<i>$1</i>')     // *Italic*
        .replace(/\[(.*?)\]\((.*?)\)/gim, "<a href='$2'>$1</a>") // [Text](Link)
        .replace(/\n/gim, '<br />');              // Line breaks

      // Convert unordered lists (lines starting with '- ')
      html = html.replace(/^\s*-\s+(.*)/gm, '<ul><li>$1</li></ul>');
      
      // Convert ordered lists (lines starting with '1. ', '2. ', etc.)
      html = html.replace(/^\s*\d+\.\s+(.*)/gm, '<ol><li>$1</li></ol>');

      // Handle nested lists and ensure they are properly wrapped
      html = html.replace(/<\/ul>\s*<ul>/g, '')  // Remove extra </ul><ul> tags
                .replace(/<\/ol>\s*<ol>/g, '')  // Remove extra </ol><ol> tags
                .replace(/<\/li><br \/><li>/g, '</li><li>'); // Handle line breaks inside lists
      
      return html;
    }

    function extractReferences(text) {
      // Regex to extract reference links and preview text if available
      const referenceRegex = /(?:\[([^\]]+)\]\(([^)]+)\))|(?:\(([^)]+)\))/g;
      let match;
      const references = [];

      while ((match = referenceRegex.exec(text)) !== null) {
        const title = match[1] || match[3];
        const url = match[2] || match[3];
        if (url && title) {
          references.push({ title, url });
        }
      }

      return references;
    }

    function renderReferenceCards(references) {
      return references.map(ref => `
        <div class="reference-card">
          <a href="${ref.url}" target="_blank" rel="noopener noreferrer">
            ${ref.title}
          </a>
        </div>
      `).join('');
    }

    document.getElementById('definition-form').addEventListener('submit', async function(event) {
      event.preventDefault();
      const definitionInput = document.getElementById('definition-input');
      const definitionContent = document.getElementById('definition-content');
      const loadingSpinner = document.getElementById('loading-spinner');

      const word = definitionInput.value.trim();
      if (word) {
        loadingSpinner.style.display = 'block';
        definitionContent.innerHTML = '';
        const content = await fetchDefinitionData(word);
        loadingSpinner.style.display = 'none';

        const htmlContent = convertMarkdownToHTML(content);
        definitionContent.innerHTML = htmlContent;

        // Extract and render reference links if present
        const references = extractReferences(content);
        if (references.length > 0) {
          definitionContent.innerHTML += '<h2>References</h2>' + renderReferenceCards(references);
        }
      }
    });
  </script>
</body>
</html>